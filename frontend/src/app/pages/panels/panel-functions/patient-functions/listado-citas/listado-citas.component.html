<section class="header">
    <h2>Listado de Citas</h2>
</section>
<section class="filter-buttons">
    <article class="filters">
      <article class="init-date-filter">
        <label for="fechaInicio">Fecha inicio</label>
        <input type="date" id="fechaInicio" [(ngModel)]="fechaInicio" (blur)="updateFilters()">
      </article>
      <article class="end-date-filter">
        <label for="fechaFin">Fecha fin</label>
        <input type="date" id="fechaFin" [(ngModel)]="fechaFin" (blur)="updateFilters()">
      </article>
      <article class="per-page-filter">
        <label for="per-page">Items</label>
        <select2 id="per-page" [data]="perPageOptions" [value]="10" [(ngModel)]="perPage" (update)="updateFilters()"></select2>
      </article>
    </article>
  </section>
@if (!dataLoaded) {
<app-loading-spinner></app-loading-spinner>
} @else if (!citas.length) {
  @if (fechaInicio || fechaFin) {
    <section class="no-results">
        <p>No se encontraron resultados con esos criterios de búsqueda.</p>
        <figure>
            <img src="assets/img/search-not-found.png" alt="No se encontraron resultados">
        </figure>
    </section>
  } @else {
    <section class="no-results">
        <p>No se encontraron citas registradas.</p>
    </section>
  }
} @else {
<section class="name-download">
    <p>Estas son tus citas, {{paciente.nombre}}</p>
</section>
<section class="medication-table">
    <div class="info">
        <small>Mostrando {{ resultMin }} - {{ resultMax }} de {{ totalItems }} citas.</small>
    </div>
    <div class="table-container">
      <table>
        <thead>
        <tr>
          <th scope="col">Hora</th>
          <th scope="col">Fecha</th>
          <th scope="col">Consulta</th>
          <th scope="col">Especialista</th>
          <th scope="col">Especialidad</th>
          <th scope="col">Acción</th>
        </tr>
        </thead>
        <tbody>
        <ng-container *ngFor="let cita of (citas | paginate: { id: 'citasListPagination', itemsPerPage: itemsPerPage, currentPage: actualPage, totalItems: totalItems })">
          <tr>
            <td>{{cita.datos_cita.hora}}</td>
            <td>{{cita.datos_cita.fecha}}</td>
            <td>{{cita.datos_cita.datos_consulta.consulta_nombre}}</td>
            <td>{{cita.datos_cita.datos_especialista.nombre}}
              {{cita.datos_cita.datos_especialista.primer_apellido}}
              {{cita.datos_cita.datos_especialista.segundo_apellido}}</td>
            <td>{{cita.datos_cita.datos_especialista.datos_especialidad.especialidad_nombre}}</td>
            @if (comprobarFecha(cita.datos_cita.hora, cita.datos_cita.fecha)) {
              <td class="btn-container">
                <div class="dropdown">
                  <button class="btn btn-link" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-three-dots-vertical"></i>
                  </button>
                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <li class="dropdown-item" href="#" (click)="confirmarCancelar(cita.datos_cita.id)"><i class="bi bi-calendar2-x-fill"></i> <span>Cancelar</span></li>
                    <li class="dropdown-item" href="#" routerLink="../ver-cita/{{cita.datos_cita.id}}"><i class="bi bi-calendar2-heart-fill"></i> <span>Ver cita</span></li>
                  </div>
                </div>
              </td>
            } @else {
              <td>
                <button type="button" class="btn btn-primary"
                        routerLink="../ver-cita/{{cita.datos_cita.id}}">Ver cita</button>
              </td>
            }
          </tr>
        </ng-container>
        </tbody>
      </table>
    </div>
    @if (previousPageUrl || nextPageUrl) {
        <div class="pagination">
          <pagination-controls
            (pageChange)="actualPage = $event; changePage(actualPage)"
            id="citasListPagination"
            maxSize="5"
            directionLinks="true"
            previousLabel="Anterior"
            nextLabel="Siguiente"
          ></pagination-controls>
        </div>
      }
</section>
}
