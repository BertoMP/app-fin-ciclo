@if (isLoading) {
<section>
    <p>Registrando especialista...</p>
    <app-loading-spinner></app-loading-spinner>
</section>
} @else {
<form [formGroup]="registerForm" (ngSubmit)="onRegisterSpecialist()">
    <h2 *ngIf="!isEditing; else isEditingH2">FORMULARIO CREAR ESPECIALISTA</h2>
    <ng-template #isEditingH2>
        <h2>FORMULARIO EDITAR ESPECIALISTA</h2>
    </ng-template>
    <section class="form-first-row">
        <fieldset class="form-personal-data">
            <legend>Datos personales</legend>
            <article class="name-field">
                <label for="name">Nombre</label>
                <input type="text" id="name" formControlName="nombre" [ngClass]="{'invalid':
                 registerForm.get('nombre').invalid && sendedAttempt }">
            </article>
            <article class="first-surname-field">
                <label for="first-surname">Primer apellido</label>
                <input type="text" id="first-surname" formControlName="primer_apellido" [ngClass]="{ 'invalid':
                 registerForm.get('primer_apellido').invalid && sendedAttempt }">
            </article>
            <article class="second-surname-field">
                <label for="second-surname">Segundo apellido</label>
                <input type="text" id="second-surname" formControlName="segundo_apellido" [ngClass]="{ 'invalid':
                 registerForm.get('segundo_apellido').invalid && sendedAttempt }">
            </article>
            <article class="dni-field">
                <label for="dni">DNI</label>
                <input type="text" id="dni" formControlName="dni" [ngClass]="{ 'invalid':
                  registerForm.get('dni').invalid && sendedAttempt }">
            </article>
        </fieldset>
        <fieldset class="form-account-data">
            <legend>Datos de acceso</legend>
            <article class="form-field">
                <label for="email">Correo electrónico</label>
                <input type="email" id="email" formControlName="email" [ngClass]="{ 'invalid':
                 registerForm.get('email').invalid &&
                 sendedAttempt }">
            </article>
            <article class="form-field">
              <label for="password" *ngIf="!isEditing; else isEditingPass">Contraseña</label>
              <ng-template #isEditingPass>
                  <label for="password">Contraseña actual</label>
              </ng-template>
              <app-password-input id="password" formControlName="password"
                                  [ngClass]="{ 'invalid': registerForm.get('password').invalid && sendedAttempt }">
              </app-password-input>
            </article>
        </fieldset>
    </section>
    <section class="form-second-row">
        <fieldset class="form-specialist-data">
            <legend>Datos especialista</legend>
            <article class="consultation-field">
                <label for="consulta">Consulta</label>
                <select2 id="consulta" formControlName="consulta" [ngClass]="{ 'invalid': registerForm.get('consulta').invalid &&
                  sendedAttempt }" [data]="consulta" placeholder="Elige una opcion">
                </select2>
            </article>
            <article class="especiality-field">
                <label for="especialidad">Especialidad</label>
                <select2 id="especialidad" formControlName="especialidad" [ngClass]="{ 'invalid': registerForm.get('especialidad').invalid &&
                  sendedAttempt }" [data]="especialidad" placeholder="Elige una opcion">
                </select2>
            </article>
            <article class="turn-field">
                <label for="turno">Turno</label>
                <select2 id="turno" formControlName="turno" [ngClass]="{ 'invalid': registerForm.get('turno').invalid &&
                  sendedAttempt }" [data]="turno" placeholder="Elige una opcion">
                </select2>
            </article>
            <article class="number-field">
                <label for="number">Nº Colegiado</label>
                <input type="number" id="number" formControlName="numero_colegiado" [ngClass]="{ 'invalid':
                 registerForm.get('numero_colegiado').invalid &&
                 sendedAttempt }">
            </article>
            <article class="image-field">
                <label for="imagen">Imagen</label>
                <input type="file" formControlName="imagen" id="imagen" [ngClass]="{ 'invalid':
                 registerForm.get('imagen').invalid &&
                 sendedAttempt }" (change)="onFileSelect($event)">
            </article>
            <article class="preview-image">
                <img *ngIf="imageBase64" [src]="imageBase64" alt="Imagen de perfil">
            </article>
            <article class="description-field">
                <label for="descripcion">Descripción</label>
                <textarea formControlName="descripcion" id="descripcion" [ngClass]="{ 'invalid':
                 registerForm.get('descripcion').invalid &&
                 sendedAttempt }"></textarea>
            </article>
        </fieldset>
        @if (registerForm.invalid && sendedAttempt) {
        <section class="error-message">
            <h3>Por favor, rellena todos los campos correctamente:</h3>
            <ul>
                @if (registerForm.get('nombre').invalid) {
                <li>
                    <strong>Nombre:</strong> Debe empezar por mayúscula y el resto de
                    letras en minúsculas, salvo en el caso de nombres compuestos.
                </li>
                }

                @if (registerForm.get('primer_apellido').invalid) {
                <li>
                    <strong>Primer apellido:</strong> Debe empezar por mayúscula y
                    el resto de letras en minúsculas, salvo en el caso de apellidos
                    compuestos.
                </li>
                }

                @if (registerForm.get('segundo_apellido').invalid) {
                <li>
                    <strong>Segundo apellido:</strong> Debe empezar por mayúscula y
                    el resto de letras en minúsculas, salvo en el caso de apellidos
                    compuestos.
                </li>
                }

                @if (registerForm.get('dni').invalid) {
                <li>
                    <strong>DNI:</strong> Debe tener un formato válido (7 u 8
                    números y una letra mayúscula. Por ejemplo: 12345678A).
                </li>
                }


                @if (registerForm.get('email').invalid) {
                <li>
                    <strong>Correo electrónico:</strong> Debe tener un formato
                    válido (usuario&#64;dominio.com | usuario&#64;dominio).
                </li>
                }

                @if (registerForm.get('password').invalid) {
                <li>
                    <strong>Contraseña:</strong> Debe tener al menos 8 caracteres,
                    una mayúscula, una minúscula, un número y un carácter especial.
                </li>
                }

                @if (registerForm.get('especialidad').invalid) {
                <li>
                    <strong>Especialidad:</strong> Debe seleccionar una opción.
                </li>
                }
                @if (registerForm.get('consulta').invalid) {
                <li>
                    <strong>Consulta:</strong> Debe seleccionar una opción.
                </li>
                }

                @if (registerForm.get('turno').invalid) {
                <li>
                    <strong>Turno:</strong> Debe seleccionar una opción.
                </li>
                }

                @if (registerForm.get('numero_colegiado').invalid) {
                <li>
                    <strong>Número Colegiado:</strong> Debe ser un número conformado por 9 dígitos (el 0 a la izquierda cuenta como dígito).
                </li>
                }

                @if (!imageBase64) {
                <li>
                    <strong>Imagen:</strong> Debe seleccionar una imagen.
                </li>
                }

                @if (registerForm.get('descripcion').invalid) {
                <li>
                    <strong>Descripción:</strong> Debe de tener una descripcion.
                </li>
                }
            </ul>
        </section>
        } @else if (errores.length>0) {
        <p class="error-message" *ngFor="let error of errores">{{ error }}</p>
        }
        <section class="btn-section">
            <button type="submit" *ngIf="!isEditing; else isEditingBtn">Registrarse</button>
            <ng-template #isEditingBtn>
                <button type="submit">Editar</button>
            </ng-template>
            <button type="button" class="btn-cancel" (click)="onCancel()">Cancelar
            </button>
        </section>
    </section>


</form>
}
